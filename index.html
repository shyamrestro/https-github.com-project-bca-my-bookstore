<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SHYAMBOOKS – Real‑Time Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body{font-family:'Poppins',sans-serif;background:#f8f9fa}
  .bg-primary{background:#00C897}.text-primary{color:#00C897}
  .btn-primary{background:#00C897;color:#fff;border-radius:9999px;padding:.6rem 1rem;font-weight:600}
  .card{border-radius:1rem;box-shadow:0 4px 12px rgba(0,0,0,.08);overflow:hidden}
  .otp-digit{width:40px;height:48px;text-align:center;font-size:1.2rem;border:1px solid #ddd;border-radius:8px}
  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);align-items:center;justify-content:center}
  .modal-content{background:#fff;padding:2rem;border-radius:1.5rem;max-width:400px;width:90%;animation:slideUp .3s}
  @keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
  .hidden{display:none!important}
</style>
</head>
<body class="min-h-screen">

<header class="fixed top-0 w-full bg-white shadow-sm z-40">
  <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
    <h1 class="text-xl font-bold text-primary">SHYAMBOOKS</h1>
    <div class="flex space-x-4">
      <button onclick="show('cart')" class="relative text-primary"><i class="fas fa-shopping-cart"></i>
        <span id="cartCnt" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
      </button>
      <button onclick="show('login')" class="text-primary"><i class="fas fa-user"></i></button>
    </div>
  </nav>
</header>

<main class="pt-20 container mx-auto px-4">

<section id="home" class="max-w-4xl mx-auto text-center">
  <h2 class="text-4xl font-bold text-primary mb-6">SHYAMBOOKS – Academic PDFs</h2>
  <button onclick="show('products')" class="btn-primary">BROWSE BOOKS</button>
</section>

<!-- LOGIN / SIGNUP / OTP – same UI as before, only JS changed -->

<section id="login" class="hidden max-w-md mx-auto">
  <div class="bg-white p-8 rounded-2xl shadow-lg">
    <h2 class="text-2xl font-bold text-center text-primary mb-6">SIGN IN</h2>
    <form onsubmit="emailLogin(event)">
      <input id="loginId" class="w-full p-3 mb-3 border rounded-lg" placeholder="Email / Mobile" required>
      <input id="loginPass" type="password" class="w-full p-3 mb-4 border rounded-lg" placeholder="Password" required>
      <button type="submit" class="btn-primary w-full">SIGN IN</button>
    </form>
    <p class="text-center mt-4"><a href="#" onclick="openOTP()" class="text-primary underline">Login with OTP</a></p>
    <p class="text-center mt-2"><a href="#" onclick="show('signup')" class="text-primary underline">Create account</a></p>
  </div>
</section>

<section id="signup" class="hidden max-w-md mx-auto">
  <div class="bg-white p-8 rounded-2xl shadow-lg">
    <h2 class="text-2xl font-bold text-center text-primary mb-6">CREATE ACCOUNT</h2>
    <form onsubmit="register(event)">
      <input id="regName" class="w-full p-3 mb-3 border rounded-lg" placeholder="Full Name" required>
      <input id="regEmail" type="email" class="w-full p-3 mb-3 border rounded-lg" placeholder="Email" required>
      <input id="regMobile" class="w-full p-3 mb-3 border rounded-lg" placeholder="Mobile (+91…)" required>
      <input id="regPass" type="password" class="w-full p-3 mb-4 border rounded-lg" placeholder="Password" required>
      <button type="submit" class="btn-primary w-full">SIGN UP</button>
    </form>
  </div>
</section>

<div id="otpModal" class="modal hidden flex">
  <div class="modal-content">
    <span class="float-right text-2xl cursor-pointer" onclick="closeOTP()">&times;</span>
    <h3 class="text-xl font-bold text-primary text-center mb-4">Enter OTP</h3>
    <p class="text-center mb-4">Sent to <span id="otpPhone"></span></p>
    <div class="flex justify-center space-x-2 mb-4">
      <input type="text" maxlength="1" class="otp-digit" oninput="moveOtp(this,0)">
      <input type="text" maxlength="1" class="otp-digit" oninput="moveOtp(this,1)">
      <input type="text" maxlength="1" class="otp-digit" oninput="moveOtp(this,2)">
      <input type="text" maxlength="1" class="otp-digit" oninput="moveOtp(this,3)">
      <input type="text" maxlength="1" class="otp-digit" oninput="moveOtp(this,4)">
      <input type="text" maxlength="1" class="otp-digit" oninput="moveOtp(this,5)">
    </div>
    <button onclick="verifyOTP()" class="btn-primary w-full">VERIFY</button>
  </div>
</div>

<section id="products" class="hidden">
  <h2 class="text-3xl font-bold text-center text-primary mb-6">ALL BOOKS</h2>
  <div id="bookGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
</section>

<section id="cart" class="hidden max-w-3xl mx-auto">
  <h2 class="text-3xl font-bold text-center text-primary mb-6">CART</h2>
  <div id="cartItems" class="space-y-4 mb-6"></div>
  <div id="cartEmpty" class="text-center py-12 hidden">
    <p class="text-xl text-gray-500">Cart is empty</p>
    <button onclick="show('products')" class="btn-primary mt-4">CONTINUE SHOPPING</button>
  </div>
  <div id="cartSummary" class="bg-white p-6 rounded-xl shadow hidden">
    <div class="flex justify-between mb-2"><span>Subtotal</span><span id="subtotal">₹0</span></div>
    <div class="flex justify-between mb-2"><span>Discount</span><span id="discount" class="text-red-600">-₹0</span></div>
    <div class="border-t pt-2 flex justify-between text-xl font-bold"><span>Total</span><span id="gtotal" class="text-primary">₹0</span></div>
    <input id="promo" placeholder="Promo code (FIRST100)" class="w-full p-2 border rounded mt-4">
    <button onclick="applyPromo()" class="btn-primary w-full mt-2">APPLY</button>
    <textarea id="address" placeholder="Delivery address" class="w-full p-2 border rounded mt-4" rows="2"></textarea>
    <button id="payBtn" onclick="payNow()" class="btn-primary w-full mt-4" disabled>PAY NOW</button>
  </div>
</section>

<section id="confirmation" class="hidden max-w-2xl mx-auto text-center">
  <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
  <h2 class="text-3xl font-bold text-primary mb-4">PAYMENT SUCCESS!</h2>
  <p class="mb-6">PDFs + Bill sent to your e‑mail.</p>
  <button onclick="show('home')" class="btn-primary mt-6">BACK HOME</button>
</section>

</main>

<script>
/* ---------- CONFIG ---------- */
const API = 'http://localhost:3000/api';
let token = localStorage.getItem('token') || null;
let cart = JSON.parse(localStorage.getItem('shy_cart') || '[]');
let isNew = true;

/* ---------- BOOKS (exact page numbers from your images) ---------- */
const books = [
  {id:1,title:'UNIT 1: INTRODUCTION TO LINUX OPERATING SYSTEM',price:499,course:'bsc',
   img:'https://via.placeholder.com/300x400/00C897/fff?text=UNIT+1',
   desc:'1.0 Introduction (Pg 5), 1.1 Objectives (Pg 5), 1.2 Features of Linux (Pg 5), 1.3 Drawbacks of Linux (Pg 6), 1.4 Components of Linux (Pg 7), 1.4.1 Memory Management Subsystem (Pg 7), 1.4.2 Linux Process and Thread Management (Pg 7), 1.4.3 File Management Subsystem (Pg 7), 1.4.4 Device Drivers (Pg 7), 1.5 Summary (Pg 13), 1.6 Solutions/Answers (Pg 14), 1.7 Further Reading (Pg 14)'},
  
  {id:2,title:'UNIT 2: LINUX COMMANDS AND UTILITIES',price:499,course:'bsc',
   img:'https://via.placeholder.com/300x400/00A884/fff?text=UNIT+2',
   desc:'2.0 Introduction (Pg 15), 2.1 Objectives (Pg 16), 2.2 Entering the Machine (Pg 16), 2.2.1 User Names and Groups (Pg 16), 2.2.2 Logging In (Pg 16), 2.2.3 Correcting Typing Mistakes (Pg 16), 2.2.4 Format of Linux Commands (Pg 16), 2.2.5 Changing Your Password (Pg 16), 2.2.6 Characters with Special Meaning (Pg 16), 2.2.7 Linux Documentation (Pg 16), 2.3 The File System (Pg 28), 2.3.1 Current Directory (Pg 28), 2.3.2 Looking at the Directory Contents (Pg 28), 2.3.3 Absolute and Relative Pathnames (Pg 28), 2.3.4 Some Linux Directories and Files (Pg 28), 2.4 Summary (Pg 39), 2.5 Solutions/Answers (Pg 39), 2.6 Further Readings (Pg 41)'},
  
  {id:3,title:'UNIT 3: LINUX UTILITIES AND EDITOR',price:499,course:'bsc',
   img:'https://via.placeholder.com/300x400/009F78/fff?text=UNIT+3',
   desc:'3.0 Introduction (Pg 42), 3.1 Objectives (Pg 42), 3.2 Some Useful Commands (Pg 43), 3.3 Permission Modes and Standard Files (Pg 45), 3.4 Pipes, Filters and Redirection (Pg 50), 3.5 Shell Scripts (Pg 53), 3.6 Graphical User Interface (Pg 60), 3.7 Editor (Pg 61), 3.8 Summary (Pg 65), 3.9 Solutions/Answers (Pg 65), 3.10 Further Readings (Pg 65)'},
  
  {id:4,title:'UNIT 4: USER TO USER COMMUNICATION',price:499,course:'bsc',
   img:'https://via.placeholder.com/300x400/008F6C/fff?text=UNIT+4',
   desc:'4.0 Introduction (Pg 67), 4.1 Objectives (Pg 67), 4.2 On-line Communication (Pg 68), 4.3 Off-line Communication (Pg 76), 4.4 Apache Server Settings (Pg 81), 4.5 Network Server Settings (Pg 85), 4.5.1 Domain Name Server (Pg 85), 4.5.2 Network File Server (Pg 85), 4.6 Summary (Pg 90), 4.7 Solutions/Answers (Pg 90), 4.8 Further Readings (Pg 91)'},
  
  {id:5,title:'UNIT 2: FURTHER READINGS (CHECK YOUR PROGRESS)',price:199,course:'bsc',
   img:'https://via.placeholder.com/300x400/FF6B6B/fff?text=CHECK',
   desc:'Check Your Progress 9, 10, 11 – Linux Commands and Utilities (Pg 41)'}
];

/* ---------- UI ---------- */
function show(id){document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');}
function badge(){const c=cart.reduce((s,i)=>s+i.qty,0);const el=document.getElementById('cartCnt');el.textContent=c;el.classList.toggle('hidden',c===0);}

/* ---------- AUTH ---------- */
async function register(e){e.preventDefault();
  const body={name:document.getElementById('regName').value,email:document.getElementById('regEmail').value,
              mobile:document.getElementById('regMobile').value,password:document.getElementById('regPass').value};
  const r=await fetch(`${API}/register`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const d=await r.json(); if(d.token){token=d.token;localStorage.setItem('token',token);isNew=true;show('home');}else alert(d.error);}
async function emailLogin(e){e.preventDefault();
  const r=await fetch(`${API}/login`,{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({id:document.getElementById('loginId').value,password:document.getElementById('loginPass').value})});
  const d=await r.json(); if(d.token){token=d.token;localStorage.setItem('token',token);isNew=d.isNewUser;show('home');}else alert(d.error);}

/* ---------- OTP ---------- */
function openOTP(){document.getElementById('otpPhone').textContent=document.getElementById('loginId').value;document.getElementById('otpModal').classList.remove('hidden');}
function closeOTP(){document.getElementById('otpModal').classList.add('hidden');}
function moveOtp(el,i){if(el.value.length===1 && i<5) document.querySelectorAll('.otp-digit')[i+1].focus();}
async function sendOTP(){await fetch(`${API}/send-otp`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mobile:document.getElementById('loginId').value})});}
async function verifyOTP(){
  const otp=[...document.querySelectorAll('.otp-digit')].map(i=>i.value).join('');
  const r=await fetch(`${API}/verify-otp`,{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({mobile:document.getElementById('loginId').value,otp})});
  const d=await r.json(); if(d.token){token=d.token;localStorage.setItem('token',token);isNew=d.isNewUser;closeOTP();show('home');}else alert('Wrong OTP');}
document.getElementById('otpModal').addEventListener('shown',sendOTP);

/* ---------- PRODUCTS ---------- */
function renderBooks(){
  const g=document.getElementById('bookGrid');g.innerHTML='';
  books.forEach(b=>{const d=document.createElement('div');d.className='bg-white p-4 rounded-xl shadow cursor-pointer';
    d.innerHTML=`<img src="${b.img}" class="w-full h-32 object-cover rounded mb-2">
      <h3 class="font-bold text-sm">${b.title}</h3>
      <p class="text-xs text-gray-600 mb-1">${b.desc}</p>
      <p class="font-bold text-primary">₹${b.price}</p>
      <button onclick="add(${b.id})" class="btn-primary w-full mt-2 text-xs">ADD</button>`;
    g.appendChild(d);});
}
function add(id){const b=books.find(x=>x.id===id);const ex=cart.find(i=>i.id===id);ex?ex.qty++:cart.push({id,qty:1,price:b.price,title:b.title});
  localStorage.setItem('shy_cart',JSON.stringify(cart));badge();renderCart();}

/* ---------- CART ---------- */
function renderCart(){
  const items=document.getElementById('cartItems');items.innerHTML='';
  const empty=document.getElementById('cartEmpty');
  const sum=document.getElementById('cartSummary');
  if(!cart.length){empty.classList.remove('hidden');sum.classList.add('hidden');return;}
  empty.classList.add('hidden');sum.classList.remove('hidden');
  cart.forEach(it=>{const b=books.find(x=>x.id===it.id);
    const div=document.createElement('div');div.className='flex items-center gap-3 bg-white p-3 rounded shadow';
    div.innerHTML=`<img src="${b.img}" class="w-16 h-20 object-cover rounded">
      <div class="flex-1"><h4 class="font-semibold text-sm">${b.title}</h4><p class="text-xs text-gray-600">₹${b.price} × ${it.qty}</p></div>
      <div class="flex items-center"><button onclick="qty(${it.id},-1)" class="w-8 h-8 rounded-full bg-gray-200">-</button>
      <span class="mx-2 font-bold">${it.qty}</span><button onclick="qty(${it.id},1)" class="w-8 h-8 rounded-full bg-gray-200">+</button></div>
      <p class="font-bold text-primary">₹${it.qty*b.price}</p>`;
    items.appendChild(div);});
  calc();
}
function qty(id,d){const it=cart.find(i=>i.id===id);it.qty+=d;if(it.qty<=0)cart=cart.filter(i=>i.id!==id);
  localStorage.setItem('shy_cart',JSON.stringify(cart));badge();renderCart();}
function calc(){
  const sub=cart.reduce((s,i)=>s+i.qty*i.price,0);
  const disc=sub*(discount/100);
  const tot=sub-disc;
  document.getElementById('subtotal').textContent=`₹${sub}`;
  document.getElementById('discount').textContent=`-₹${disc}`;
  document.getElementById('gtotal').textContent=`₹${tot}`;
  document.getElementById('payBtn').disabled=tot===0||!document.getElementById('address').value.trim();
}
let discount=0;
function applyPromo(){
  const c=document.getElementById('promo').value.trim().toUpperCase();
  if(c==='FIRST100'&&isNew){discount=100;alert('100% OFF!');}
  else if(c==='SAVE50'){discount=50;alert('50% OFF!');}
  else{discount=0;alert('Invalid');}
  calc();
}

/* ---------- PAYMENT ---------- */
async function payNow(){
  const address=document.getElementById('address').value.trim();
  if(!address) return alert('Enter address');
  const total=parseInt(document.getElementById('gtotal').textContent.replace('₹',''));
  const order=await (await fetch(`${API}/create-order`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},
    body:JSON.stringify({amount:total})})).json();
  const options={
    key:process.env.RAZORPAY_KEY_ID?.slice(0,15)||'rzp_test_xxx',
    amount:total*100,currency:'INR',name:'ShyamBooks',description:'PDFs',
    order_id:order.id,
    handler:async function(res){
      const verify=await fetch(`${API}/verify-payment`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},
        body:JSON.stringify({razorpay_payment_id:res.razorpay_payment_id,razorpay_order_id:res.razorpay_order_id,
          razorpay_signature:res.razorpay_signature,items:cart.map(i=>({bookId:i.id,qty:i.qty,price:i.price,title:i.title})),total,address})});
      if((await verify.json()).ok){
        await fetch(`${API}/send-pdf-email`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},
          body:JSON.stringify({items:cart.map(i=>({bookId:i.id,qty:i.qty,price:i.price,title:i.title})),address})});
        cart=[];localStorage.removeItem('shy_cart');badge();show('confirmation');
      }
    },
    prefill:{email:'',contact:''},theme:{color:'#00C897'}
  };
  new Razorpay(options).open();
}

/* ---------- INIT ---------- */
function init(){
  badge(); renderBooks();
  token?show('home'):show('login');
}
init();
</script>
</body>
</html>